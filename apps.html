<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apps ‚Äî Life OS</title>
<link rel="stylesheet" href="css/main.css?v=2">
<style>
.app-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 12px;
}
.app-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 20px 12px;
  border-radius: var(--radius);
  background: var(--white);
  box-shadow: var(--shadow);
  text-decoration: none;
  color: var(--gray-800);
  text-align: center;
  transition: opacity 0.15s;
}
.app-card:active { opacity: 0.75; }
.app-card-icon  { font-size: 32px; }
.app-card-label { font-size: 14px; font-weight: 700; }
.app-card-sub   { font-size: 12px; color: var(--gray-400); margin-top: 2px; }
.app-card-badge {
  font-size: 11px;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 99px;
  margin-top: 2px;
}
</style>
</head>
<body>

<header class="page-header">
  <div class="header-row">
    <div>
      <h1>Apps</h1>
      <div class="subtitle">Todos tus paneles</div>
    </div>
  </div>
</header>

<main class="content">

  <div class="section-label">Negocios</div>
  <div class="app-grid">
    <a href="tov.html" class="app-card" style="border-top:3px solid var(--green)">
      <div class="app-card-icon">üé•</div>
      <div class="app-card-label">Take One Visuals</div>
      <div class="app-card-sub" id="tov-sub">Clients & weddings</div>
    </a>
    <a href="parents.html" class="app-card" style="border-top:3px solid var(--coral)">
      <div class="app-card-icon">üìû</div>
      <div class="app-card-label">Parent CRM</div>
      <div class="app-card-sub">Comunicaciones</div>
    </a>
  </div>

  <div class="section-label">Personal</div>
  <div class="app-grid">
    <a href="health.html" class="app-card" style="border-top:3px solid var(--coral)">
      <div class="app-card-icon">üèÉ</div>
      <div class="app-card-label">Health</div>
      <div class="app-card-sub" id="health-sub">Food & exercise</div>
    </a>
    <a href="languages.html" class="app-card" style="border-top:3px solid var(--purple)">
      <div class="app-card-icon">üåç</div>
      <div class="app-card-label">Languages</div>
      <div class="app-card-sub" id="lang-sub">Spanish & Russian</div>
    </a>
  </div>

  <div class="section-label">Herramientas Escolares</div>
  <div class="app-grid">
    <a href="students.html" class="app-card" style="border-top:3px solid var(--blue)">
      <div class="app-card-icon">üéì</div>
      <div class="app-card-label">Students</div>
      <div class="app-card-sub" id="students-sub">All profiles</div>
    </a>
    <a href="classes.html" class="app-card" style="border-top:3px solid var(--orange)">
      <div class="app-card-icon">üìö</div>
      <div class="app-card-label">Classes</div>
      <div class="app-card-sub" id="classes-sub">All dashboards</div>
    </a>
  </div>

</main>

<nav class="bottom-nav">
  <a href="school.html" class="nav-item">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="M9 22V12h6v10"/></svg>
    Escuela
  </a>
  <a href="apps.html" class="nav-item active">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
    Apps
  </a>
  <a href="index.html" class="nav-item">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    Panel
  </a>
  <a href="calendar.html" class="nav-item">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><circle cx="8" cy="16" r="1" fill="currentColor"/><circle cx="12" cy="16" r="1" fill="currentColor"/></svg>
    Calendario
  </a>
  <a href="tasks.html" class="nav-item">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
    Tareas
  </a>
</nav>

<script type="module">
import { supabase } from './js/supabase.js';
import { today } from './js/utils.js';
const T = today();

async function loadStats() {
  const [tovRes, langRes, studRes, clsRes, exRes] = await Promise.all([
    supabase.from('tov_clients').select('id, wedding_date').gte('wedding_date', T).order('wedding_date').limit(1),
    supabase.from('vocab_words').select('id', { count: 'exact' }).lte('next_review', T),
    supabase.from('students').select('id', { count: 'exact' }).eq('status', 'Active'),
    supabase.from('classes').select('id', { count: 'exact' }),
    supabase.from('exercise_log').select('date').order('date', { ascending: false }).limit(1),
  ]);

  const tov = document.getElementById('tov-sub');
  if (tov) {
    const next = tovRes.data?.[0];
    tov.textContent = next
      ? `Next: ${next.wedding_date.slice(5).replace('-', '/')}`
      : 'No upcoming weddings';
  }

  const lang = document.getElementById('lang-sub');
  if (lang) lang.textContent = `${langRes.count ?? 0} words due for review`;

  const stud = document.getElementById('students-sub');
  if (stud) stud.textContent = `${studRes.count ?? 0} active students`;

  const cls = document.getElementById('classes-sub');
  if (cls) cls.textContent = `${clsRes.count ?? 0} classes`;

  const health = document.getElementById('health-sub');
  if (health) {
    const lastEx = exRes.data?.[0]?.date;
    const daysSince = lastEx ? Math.floor((new Date(T) - new Date(lastEx)) / 86400000) : null;
    health.textContent = daysSince === null ? 'No exercise logged'
      : daysSince === 0 ? 'Exercise logged today ‚úì'
      : `Last exercise: ${daysSince}d ago`;
  }

}

loadStats();
</script>
<script type="module" src="js/topbar.js"></script>
</body>
</html>
